<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Guerra de Guildas PRO</title>
    <style>
        :root { --gold: #ffb400; --orange: #ff6a00; --bg: #0d0d0d; --card: #3d2616; --text: #e0e0e0; }
        
        * { 
            touch-action: pan-y; 
            user-select: none; 
            -webkit-user-select: none;
            box-sizing: border-box;
        }

        body { 
            background: var(--bg); color: var(--text); font-family: sans-serif; 
            margin: 0; padding-bottom: 220px; 
            overscroll-behavior-y: contain;
        }
        
        .header { background: #000; padding: 12px; text-align: center; border-bottom: 2px solid var(--gold); font-weight: bold; position: sticky; top: 0; z-index: 100; }
        
        .stats-row { display: flex; justify-content: space-around; padding: 10px; background: #1a1a1a; color: var(--gold); font-size: 13px; position: sticky; top: 43px; z-index: 100; border-bottom: 1px solid #333; }

        .ranking-list { padding: 10px; }
        .guild-card { 
            display: flex; align-items: center; background: var(--card); 
            margin-bottom: 8px; padding: 15px; border-radius: 6px;
            border-left: 5px solid var(--gold);
        }
        
        .rank-pos { width: 45px; font-weight: bold; color: var(--gold); font-size: 20px; }
        .guild-info { flex-grow: 1; display: flex; justify-content: space-between; align-items: center; }
        .guild-pts { color: #00ff44; font-weight: bold; font-family: monospace; font-size: 16px; }

        .menu-bar { 
            position: fixed; bottom: 30px; left: 0; width: 100%; 
            background: rgba(10, 10, 10, 0.98); border-top: 2px solid var(--gold);
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px;
            z-index: 999;
        }
        
        button { 
            background: linear-gradient(180deg, var(--gold), var(--orange)); 
            border: none; padding: 14px 2px; font-weight: bold; border-radius: 4px; 
            text-transform: uppercase; font-size: 10px; color: #000;
            box-shadow: 0 3px 0 #804000;
        }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; }
        .modal-content { 
            background: #222; margin: 5% auto; padding: 20px; width: 90%; 
            border: 2px solid var(--gold); border-radius: 10px; 
            height: 80vh; overflow-y: auto;
        }
        
        input { width: 100%; padding: 15px; margin: 10px 0; background: #333; border: 1px solid #555; color: #fff; border-radius: 5px; }
        .player-row { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #444; }
        .skill-badge { font-size: 9px; padding: 2px 6px; border-radius: 10px; background: #555; color: #fff; margin-left: 5px; }
    </style>
</head>
<body>

<div class="header">GUERRA DE GUILDAS PRO</div>
<div class="stats-row">
    <span>TEMPORADA: <span id="temp-atual">1</span></span>
    <span>TIMER: <span id="timer">60:00</span></span>
</div>

<div class="ranking-list" id="ranking-container"></div>

<div class="menu-bar">
    <button onclick="iniciarGuerra()" id="btn-iniciar">INICIAR</button>
    <button onclick="abrirAdd()">EDITAR NOME</button>
    <button onclick="verDetalhes()">VER GUILDA</button>
    <button onclick="verTitulos()">T√çTULOS</button>
    <button onclick="renderizar()">ATUALIZAR</button>
    <button onclick="limparDados()" style="background:#cc0000; color:white;">RESET</button>
</div>

<div id="modal-geral" class="modal">
    <div class="modal-content" id="modal-body"></div>
</div>

<script>
    const nomesFera = ["Nobru", "Bak", "Thurzin", "Moreira", "Dantes", "Ghost", "Complex", "Mito", "Jordan", "Lzinn", "Rekkon", "Two9", "Next", "Splash", "ViniJr", "R7", "Bkr", "Zuao", "Kito", "Phx", "Dudu", "Guh", "Teteu", "Biel", "Xand", "Nando", "Mestre", "Cria", "Apelapato"];
    
    let guildas = [];
    let temporadaAtual = 1;
    let tempoRestante = 3600;
    let rodando = false;

    function gerarMembros() {
        let time = [];
        for(let i=0; i<30; i++) {
            let sk = parseFloat((Math.random() * 1.5 + 0.5).toFixed(1));
            time.push({
                nome: nomesFera[Math.floor(Math.random() * nomesFera.length)] + "_" + Math.floor(Math.random()*99),
                pts: 0,
                skill: sk
            });
        }
        return time;
    }

    function criarGuilda(nome) {
        return {
            id: "ID-" + Math.random().toString(36).substr(2, 9),
            nome: nome, 
            pontos: 0, 
            players: gerarMembros(),
            titulos: []
        };
    }

    function salvar() {
        localStorage.setItem('guerra_final_v1', JSON.stringify({ 
            guildas, temporadaAtual, tempoRestante, rodando, last: Date.now() 
        }));
    }

    function carregar() {
        const dados = localStorage.getItem('guerra_final_v1');
        if (dados) {
            const d = JSON.parse(dados);
            guildas = d.guildas;
            temporadaAtual = d.temporadaAtual;
            rodando = d.rodando;
            tempoRestante = d.tempoRestante;
            
            let passados = Math.floor((Date.now() - d.last) / 1000);
            if(rodando && passados > 0) {
                guildas.forEach(g => {
                    let media = g.players.reduce((a,b) => a + b.skill, 0) / 30;
                    let ganho = Math.floor(passados * media * 0.4);
                    g.pontos += ganho;
                });
                tempoRestante = Math.max(0, tempoRestante - passados);
            }
        } else {
            for(let i=1; i<=100; i++) guildas.push(criarGuilda("Guilda " + i));
        }
        renderizar();
        if(rodando) loop();
    }

    function loop() {
        if(!rodando || tempoRestante <= 0) return;
        tempoRestante--;
        
        guildas.forEach(g => {
            let sk = g.players.reduce((a,b) => a + b.skill, 0) / 30;
            if(Math.random() < (0.05 * sk)) {
                let p = Math.floor(Math.random() * 35 * sk);
                g.pontos += p;
                g.players[Math.floor(Math.random()*30)].pts += p;
            }
        });

        if(tempoRestante % 10 === 0) {
            atualizarRelogio();
            salvar();
        }
        setTimeout(loop, 1000);
    }

    function renderizar() {
        const container = document.getElementById('ranking-container');
        container.innerHTML = "";
        guildas.sort((a,b) => b.pontos - a.pontos);
        guildas.slice(0, 100).forEach((g, i) => {
            container.innerHTML += `
                <div class="guild-card">
                    <div class="rank-pos">${i + 1}¬∫</div>
                    <div class="guild-info">
                        <div class="guild-name">${g.nome}</div>
                        <div class="guild-pts">${g.pontos}</div>
                    </div>
                </div>`;
        });
        document.getElementById('temp-atual').innerText = temporadaAtual;
        atualizarRelogio();
    }

    function abrirAdd() {
        const m = document.getElementById('modal-body');
        m.innerHTML = `
            <h3>TROCAR NOME</h3>
            <input type="text" id="oldN" placeholder="Nome atual (Ex: Guilda 5)">
            <input type="text" id="newN" placeholder="Novo nome">
            <button onclick="confirmaTroca()" style="width:100%">SALVAR NOME</button>
            <button onclick="fechar()" style="width:100%; margin-top:10px; background:#555; color:#fff">VOLTAR</button>
        `;
        document.getElementById('modal-geral').style.display = 'block';
    }

    function confirmaTroca() {
        let o = document.getElementById('oldN').value;
        let n = document.getElementById('newN').value;
        let g = guildas.find(x => x.nome.toLowerCase() === o.toLowerCase());
        if(g && n) {
            g.nome = n.toUpperCase();
            fechar(); renderizar(); salvar();
        } else { alert("Nome original n√£o encontrado!"); }
    }

    function verDetalhes() {
        let r = prompt("Posi√ß√£o no Rank (1-100):");
        if(!r) return;
        let g = guildas[parseInt(r)-1];
        if(!g) return;

        const m = document.getElementById('modal-body');
        let pH = g.players.sort((a,b) => b.pts - a.pts).map(p => `
            <div class="player-row">
                <span>${p.nome} <span class="skill-badge">SKILL: ${p.skill}</span></span>
                <span style="color:#0f0">+${p.pts}</span>
            </div>`).join("");
            
        m.innerHTML = `
            <h2>${g.nome}</h2>
            <button onclick="novoTime('${g.id}')" style="width:100%; margin-bottom:15px">RECRUTAR NOVOS (RESET SKILL)</button>
            ${pH}
            <button onclick="fechar()" style="width:100%; margin-top:15px; background:#f44; color:#fff">FECHAR</button>
        `;
        document.getElementById('modal-geral').style.display = 'block';
    }

    function novoTime(id) {
        let g = guildas.find(x => x.id === id);
        if(confirm("Deseja trocar os jogadores? Isso altera a skill da guilda.")) {
            g.players = gerarMembros();
            fechar(); renderizar(); salvar();
        }
    }

    function verTitulos() {
        let r = prompt("Posi√ß√£o no Rank (1-100):");
        if(!r) return;
        let g = guildas[parseInt(r)-1];
        if(!g) return;
        const m = document.getElementById('modal-body');
        let tH = g.titulos.map(t => `<p>üèÜ TEMP ${t.temp}: ${t.pos}¬∫ LUGAR</p>`).join("");
        m.innerHTML = `<h3>GALERIA: ${g.nome}</h3>${tH || "Nenhum trof√©u ainda"}<button onclick="fechar()" style="width:100%; margin-top:20px">VOLTAR</button>`;
        document.getElementById('modal-geral').style.display = 'block';
    }

    function atualizarRelogio() {
        let m = Math.floor(tempoRestante / 60); let s = tempoRestante % 60;
        document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
    }

    function iniciarGuerra() { rodando = true; document.getElementById('btn-iniciar').innerText="NO AR"; loop(); }
    function fechar() { document.getElementById('modal-geral').style.display = 'none'; }
    function limparDados() { if(confirm("APAGAR TUDO?")) { localStorage.clear(); location.reload(); } }
    
    window.onload = carregar;
</script>
</body>
</html>
