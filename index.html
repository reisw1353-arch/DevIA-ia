<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DevAI Pro - Manager</title>
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/tokyo-night-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <style>
        * { box-sizing: border-box; }
        body { background: #050505; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100dvh; overflow: hidden; }

        /* Menu Lateral */
        #sidebar { width: 260px; background: #0a0a0a; border-right: 1px solid #222; display: flex; flex-direction: column; transition: 0.3s; position: absolute; left: -260px; height: 100%; z-index: 1000; }
        #sidebar.open { left: 0; }
        .sidebar-header { padding: 15px; border-bottom: 1px solid #222; }
        .new-chat-btn { width: 100%; padding: 10px; background: transparent; border: 1px solid #444; color: white; border-radius: 5px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .chat-list { flex: 1; overflow-y: auto; padding: 10px; }
        .chat-item { padding: 10px; border-radius: 5px; cursor: pointer; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 5px; border-bottom: 1px solid #111; }
        .chat-item:hover { background: #1e1e1e; }

        /* Área Principal */
        main { flex: 1; display: flex; flex-direction: column; width: 100%; }
        header { padding: 15px; background: #0a0a0a; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; height: 60px; }
        .menu-toggle { font-size: 20px; cursor: pointer; }

        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 12px 18px; border-radius: 15px; max-width: 90%; font-size: 15px; position: relative; }
        .user { align-self: flex-end; background: #007bff; border-bottom-right-radius: 2px; }
        .ia { align-self: flex-start; background: #1e1e1e; border: 1px solid #333; border-bottom-left-radius: 2px; width: 100%; }

        pre { background: #000 !important; padding: 15px; border-radius: 8px; overflow-x: auto; border: 1px solid #444; position: relative; margin: 10px 0; }
        .btn-copy { position: absolute; top: 5px; right: 5px; background: #333; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; font-size: 12px; }

        .input-area { padding: 10px 15px; background: #0a0a0a; display: flex; gap: 10px; height: 70px; border-top: 1px solid #222; }
        input { flex: 1; background: #151515; color: white; border: 1px solid #333; padding: 12px; border-radius: 8px; font-size: 16px; outline: none; }
        #btnEnviar { background: #007bff; border: none; color: white; padding: 0 20px; border-radius: 8px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="sidebar">
        <div class="sidebar-header">
            <button class="new-chat-btn" onclick="iniciarNovoChat()">+ Nova Conversa</button>
        </div>
        <div id="chatList" class="chat-list"></div>
    </div>

    <main>
        <header>
            <div class="menu-toggle" onclick="toggleSidebar()">☰</div>
            <div style="color: #007bff; font-weight: bold;">DevAI Pro ⚡</div>
            <div onclick="iniciarNovoChat()" style="cursor:pointer; font-size: 20px;">+</div>
        </header>

        <div id="chat"></div>

        <div class="input-area">
            <input type="text" id="prompt" placeholder="Sua mensagem..." autocomplete="off">
            <button id="btnEnviar">➤</button>
        </div>
    </main>

    <script>
        const chatContainer = document.getElementById('chat');
        const chatListContainer = document.getElementById('chatList');
        const input = document.getElementById('prompt');
        const CHAVE = "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";

        let chatAtualId = Date.now();
        let historico = [];
        let todasConversas = JSON.parse(localStorage.getItem('devai_chats')) || {};

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }

        function salvarNoLocalStorage() {
            if (historico.length > 1) {
                const titulo = historico[1].content.substring(0, 30) + "...";
                todasConversas[chatAtualId] = { titulo, historico };
                localStorage.setItem('devai_chats', JSON.stringify(todasConversas));
                renderizarListaConversas();
            }
        }

        function renderizarListaConversas() {
            chatListContainer.innerHTML = '';
            Object.keys(todasConversas).reverse().forEach(id => {
                const div = document.createElement('div');
                div.className = 'chat-item';
                div.innerText = todasConversas[id].titulo;
                div.onclick = () => carregarConversa(id);
                chatListContainer.appendChild(div);
            });
        }

        function carregarConversa(id) {
            chatAtualId = id;
            historico = todasConversas[id].historico;
            chatContainer.innerHTML = '';
            historico.forEach(msg => {
                if (msg.role !== 'system') {
                    renderizarMensagem(msg.role === 'user' ? 'user' : 'ia', msg.content);
                }
            });
            toggleSidebar();
        }

        function iniciarNovoChat() {
            chatAtualId = Date.now();
            historico = [{ role: "system", content: "Responda em português com blocos de código." }];
            chatContainer.innerHTML = '<div class="msg ia">Nova conversa iniciada. O que vamos codar hoje?</div>';
            if(document.getElementById('sidebar').classList.contains('open')) toggleSidebar();
        }

        function renderizarMensagem(tipo, texto) {
            const div = document.createElement('div');
            div.className = `msg ${tipo}`;
            div.innerHTML = marked.parse(texto);
            chatContainer.appendChild(div);
            aplicarBotaoCopiar(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            hljs.highlightAll();
        }

        function aplicarBotaoCopiar(container) {
            container.querySelectorAll('pre').forEach(pre => {
                const btn = document.createElement('button');
                btn.className = 'btn-copy';
                btn.innerText = 'Copiar';
                btn.onclick = () => {
                    navigator.clipboard.writeText(pre.querySelector('code').innerText);
                    btn.innerText = 'Copiado!';
                    setTimeout(() => btn.innerText = 'Copiar', 2000);
                };
                pre.appendChild(btn);
            });
        }

        async function enviar() {
            const texto = input.value.trim();
            if (!texto) return;

            renderizarMensagem('user', texto);
            historico.push({ role: "user", content: texto });
            input.value = "";

            const tempId = "ia-" + Date.now();
            const divIA = document.createElement('div');
            divIA.className = 'msg ia';
            divIA.id = tempId;
            divIA.innerHTML = "<i>Digitando...</i>";
            chatContainer.appendChild(divIA);

            try {
                const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${CHAVE}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ model: "llama-3.3-70b-versatile", messages: historico })
                });
                const data = await res.json();
                const resp = data.choices[0].message.content;
                historico.push({ role: "assistant", content: resp });
                divIA.innerHTML = marked.parse(resp);
                aplicarBotaoCopiar(divIA);
                salvarNoLocalStorage();
            } catch { divIA.innerText = "Erro."; }
            chatContainer.scrollTop = chatContainer.scrollHeight;
            hljs.highlightAll();
        }

        document.getElementById('btnEnviar').onclick = enviar;
        input.onkeypress = (e) => { if(e.key === 'Enter') enviar(); };
        
        iniciarNovoChat();
        renderizarListaConversas();
    </script>
</body>
</html>
